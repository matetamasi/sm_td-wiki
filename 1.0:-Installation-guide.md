1. Add `DEFERRED_EXEC_ENABLE = yes` to your `rules.mk` file
2. Add `#define MAX_DEFERRED_EXECUTORS 10` (or more than 10) to your `config.h` file
3. Clone `sm_td.h` repository into your `keymaps/your_keymap` folder (next to your keymap.c)
4. Add `#include "sm_td.h"` to your `keymap.c` file
5. Check `!process_smtd` first in your `process_record_user` function like this
```c
bool process_record_user(uint16_t keycode, keyrecord_t *record) {
    if (!process_smtd(keycode, record)) {
        return false;
    }
    // your code here
}
```
6. Add some custom keycodes to your `keymaps`, so sm_td library can use them without conflicts
7. Declare variable `smtd_states` your custom keycodes and variable `smtd_states_size` for sm_td library like this:
```c
smtd_state smtd_states[] = {
    SMTD(CUSTOM_KEYCODE_1),
    SMTD(CUSTOM_KEYCODE_2),
    // put all your custom keycodes here
}

// this is the size of your custom keycodes array, it is used for internal purposes. Do not delete this
size_t smtd_states_size = sizeof(smtd_states) / sizeof(smtd_states[0]);
```
8. Describe your custom keycodes in `on_smtd_action` function like this:
```c
void on_smtd_action(uint16_t keycode, smtd_action action, uint8_t tap_count) {
    switch (keycode) {
        case CKC_SPACE: {
            switch (CUSTOM_KEYCODE_1) {
                case SMTD_ACTION_TOUCH:
                    break; // touch action are not used in this example  
                case SMTD_ACTION_TAP:
                    // this is a tap action for CUSTOM_KEYCODE_1
                    tap_code(KC_SPACE);
                    break;
                case SMTD_ACTION_HOLD:
                    // this is a hold action for CUSTOM_KEYCODE_1
                    if (tap_count == 0 || tap_count == 1) {
                        layer_move(4);
                    } else {
                        // sending hold for OS
                        register_code(KC_SPACE); 
                    }
                    break;
                case SMTD_ACTION_RELEASE:
                    // this is a release action for CUSTOM_KEYCODE_1
                    if (tap_count == 0 || tap_count == 1) {
                        layer_move(0);
                    } else {
                        // releasing hold for OS
                        unregister_code(KC_SPACE);
                    }
                    break;
            }
            break;
        } // end of case CKC_SPACE
            
        // put all your custom keycodes here
        
    } // end of switch (keycode)
} // end of on_smtd_action function
```

9. (optional) Add global configuration 

See next chapters.

10. (optional) Add configuration per key

See next chapters.